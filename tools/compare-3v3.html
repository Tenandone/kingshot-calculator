<!doctype html>
<html lang="ko">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>SSR 영웅 A vs B 비교 계산기</title>
<style>
  :root{--fg:#111;--muted:#666;--bd:#e5e7eb;--pri:#0b57d0}
  body{font-family:system-ui,-apple-system,Segoe UI,Roboto,Pretendard,sans-serif;margin:0;background:#fff;color:var(--fg)}
  header{padding:18px 20px 8px}
  h1{margin:0 0 6px;font-size:20px}
  .muted{color:var(--muted);font-size:13px}
  main{padding:0 20px 24px;max-width:1100px;margin:auto}
  .lane{border:1px solid var(--bd);border-radius:14px;background:#fff;margin-top:14px}
  .lane h2{margin:0;padding:12px 14px;border-bottom:1px solid var(--bd);font-size:16px}
  .row{display:grid;grid-template-columns:1fr 1fr;gap:12px;padding:12px 14px}
  .card{border:1px solid var(--bd);border-radius:12px;padding:10px 12px}
  .title{display:flex;align-items:center;gap:10px;margin-bottom:6px}
  .select{min-width:220px;padding:8px 10px;border:1px solid var(--bd);border-radius:10px;font-size:14px;width:100%}
  .badge{display:inline-block;padding:2px 8px;border-radius:999px;background:#eef3ff;color:#1b56d6;font-size:12px}
  .kv{display:flex;gap:8px;align-items:center;font-size:13px;margin-top:6px;flex-wrap:wrap}
  .kv b{font-size:14px}
  .slider{width:100%}
  .cmp{border-top:1px dashed var(--bd);padding:10px 14px;color:#333;font-size:14px}
  .cmp .muted{font-size:12px;color:#666}

  /* ====== 별(0~6 단계 이미지) ====== */
  .stars{display:flex;gap:4px;align-items:center}
  .star{
    width:24px;height:24px;display:inline-block;
    background-size:contain;background-repeat:no-repeat;background-position:center;
  }
  .star[data-lv="0"]{ background-image:url('/img/star/0.webp'); }
  .star[data-lv="1"]{ background-image:url('/img/star/1.webp'); }
  .star[data-lv="2"]{ background-image:url('/img/star/2.webp'); }
  .star[data-lv="3"]{ background-image:url('/img/star/3.webp'); }
  .star[data-lv="4"]{ background-image:url('/img/star/4.webp'); }
  .star[data-lv="5"]{ background-image:url('/img/star/5.webp'); }
  .star[data-lv="6"]{ background-image:url('/img/star/6.webp'); }

  /* ====== 초상화 ====== */
  .portraitWrap{display:flex;justify-content:center;margin-bottom:8px}
  .portrait{
    width:96px;height:96px;object-fit:cover;border-radius:10px;
    border:1px solid var(--bd);background:#f6f7fb;display:block
  }

  @media (max-width:760px){ .row{grid-template-columns:1fr} }
</style>
</head>
<body>
<a href="/" class="kd-home-link" style="display:block;padding:10px 14px;font:600 13px/1 system-ui,-apple-system,Segoe UI,Roboto,Pretendard,sans-serif;text-decoration:none;color:#0b57d0">
  ← KingshotData Korea
</a>

<header>
  <h1>SSR 영웅 A vs B 비교 계산기</h1>
  <div class="muted">
    병종별로 A와 B 영웅을 선택하고 각 단계를 조절하면
    아래에 “A가 B를 이기려면 최소 몇 단계가 필요한지”가 바로 표시됩니다.
  </div>
</header>

<main>
  <!-- 보병 -->
  <section class="lane" data-type="infantry">
    <h2>보병</h2>
    <div class="row">
      <div class="card">
        <!-- 초상화 -->
        <div class="portraitWrap">
          <img class="portrait" data-side="A" alt="A 영웅 초상화" width="96" height="96" loading="lazy" />
        </div>
        <div class="title"><span class="badge">A</span><select class="select hero" data-side="A"></select></div>
        <div class="kv">
          <label>단계: <input type="range" min="1" max="30" step="1" class="slider lvl" data-side="A"></label>
          <span class="badge lvlLabel" data-side="A">0★ T1</span>
          <div class="stars" data-side="A" aria-label="A 성급">
            <span class="star" data-lv="0"></span><span class="star" data-lv="0"></span>
            <span class="star" data-lv="0"></span><span class="star" data-lv="0"></span>
            <span class="star" data-lv="0"></span>
          </div>
        </div>
        <div class="kv"><span>현재 수치</span> <b class="stat" data-side="A">+0.00%</b></div>
      </div>

      <div class="card">
        <!-- 초상화 -->
        <div class="portraitWrap">
          <img class="portrait" data-side="B" alt="B 영웅 초상화" width="96" height="96" loading="lazy" />
        </div>
        <div class="title"><span class="badge">B</span><select class="select hero" data-side="B"></select></div>
        <div class="kv">
          <label>단계: <input type="range" min="1" max="30" step="1" class="slider lvl" data-side="B"></label>
          <span class="badge lvlLabel" data-side="B">0★ T1</span>
          <div class="stars" data-side="B" aria-label="B 성급">
            <span class="star" data-lv="0"></span><span class="star" data-lv="0"></span>
            <span class="star" data-lv="0"></span><span class="star" data-lv="0"></span>
            <span class="star" data-lv="0"></span>
          </div>
        </div>
        <div class="kv"><span>현재 수치</span> <b class="stat" data-side="B">+0.00%</b></div>
      </div>
    </div>
    <div class="cmp"><span class="cmpText"></span><div class="muted cmpHint"></div></div>
  </section>

  <!-- 기병 -->
  <section class="lane" data-type="cavalry">
    <h2>기병</h2>
    <div class="row">
      <div class="card">
        <div class="portraitWrap">
          <img class="portrait" data-side="A" alt="A 영웅 초상화" width="96" height="96" loading="lazy" />
        </div>
        <div class="title"><span class="badge">A</span><select class="select hero" data-side="A"></select></div>
        <div class="kv">
          <label>단계: <input type="range" min="1" max="30" step="1" class="slider lvl" data-side="A"></label>
          <span class="badge lvlLabel" data-side="A">0★ T1</span>
          <div class="stars" data-side="A" aria-label="A 성급">
            <span class="star" data-lv="0"></span><span class="star" data-lv="0"></span>
            <span class="star" data-lv="0"></span><span class="star" data-lv="0"></span>
            <span class="star" data-lv="0"></span>
          </div>
        </div>
        <div class="kv"><span>현재 수치</span> <b class="stat" data-side="A">+0.00%</b></div>
      </div>

      <div class="card">
        <div class="portraitWrap">
          <img class="portrait" data-side="B" alt="B 영웅 초상화" width="96" height="96" loading="lazy" />
        </div>
        <div class="title"><span class="badge">B</span><select class="select hero" data-side="B"></select></div>
        <div class="kv">
          <label>단계: <input type="range" min="1" max="30" step="1" class="slider lvl" data-side="B"></label>
          <span class="badge lvlLabel" data-side="B">0★ T1</span>
          <div class="stars" data-side="B" aria-label="B 성급">
            <span class="star" data-lv="0"></span><span class="star" data-lv="0"></span>
            <span class="star" data-lv="0"></span><span class="star" data-lv="0"></span>
            <span class="star" data-lv="0"></span>
          </div>
        </div>
        <div class="kv"><span>현재 수치</span> <b class="stat" data-side="B">+0.00%</b></div>
      </div>
    </div>
    <div class="cmp"><span class="cmpText"></span><div class="muted cmpHint"></div></div>
  </section>

  <!-- 궁병 -->
  <section class="lane" data-type="archer">
    <h2>궁병</h2>
    <div class="row">
      <div class="card">
        <div class="portraitWrap">
          <img class="portrait" data-side="A" alt="A 영웅 초상화" width="96" height="96" loading="lazy" />
        </div>
        <div class="title"><span class="badge">A</span><select class="select hero" data-side="A"></select></div>
        <div class="kv">
          <label>단계: <input type="range" min="1" max="30" step="1" class="slider lvl" data-side="A"></label>
          <span class="badge lvlLabel" data-side="A">0★ T1</span>
          <div class="stars" data-side="A" aria-label="A 성급">
            <span class="star" data-lv="0"></span><span class="star" data-lv="0"></span>
            <span class="star" data-lv="0"></span><span class="star" data-lv="0"></span>
            <span class="star" data-lv="0"></span>
          </div>
        </div>
        <div class="kv"><span>현재 수치</span> <b class="stat" data-side="A">+0.00%</b></div>
      </div>

      <div class="card">
        <div class="portraitWrap">
          <img class="portrait" data-side="B" alt="B 영웅 초상화" width="96" height="96" loading="lazy" />
        </div>
        <div class="title"><span class="badge">B</span><select class="select hero" data-side="B"></select></div>
        <div class="kv">
          <label>단계: <input type="range" min="1" max="30" step="1" class="slider lvl" data-side="B"></label>
          <span class="badge lvlLabel" data-side="B">0★ T1</span>
          <div class="stars" data-side="B" aria-label="B 성급">
            <span class="star" data-lv="0"></span><span class="star" data-lv="0"></span>
            <span class="star" data-lv="0"></span><span class="star" data-lv="0"></span>
            <span class="star" data-lv="0"></span>
          </div>
        </div>
        <div class="kv"><span>현재 수치</span> <b class="stat" data-side="B">+0.00%</b></div>
      </div>
    </div>
    <div class="cmp"><span class="cmpText"></span><div class="muted cmpHint"></div></div>
  </section>
</main>

<script>
/* ================== 이미지 경로 설정 ================== */
/* 웹 배포용 기본 경로(권장): /img/heroes/{영웅영문명}/img_001.webp */
const PORTRAIT_BASE = '/img/heroes/';
/* 로컬 파일 경로를 직접 쓰려면(개발용):
   예) const PORTRAIT_BASE = 'file:///C:/Users/ant79/Documents/kingshot-calculator/img/heroes/';
   주의: file:// 경로는 서버에서 열 때 브라우저 정책으로 차단될 수 있음. 가능하면 위의 웹 경로를 쓰고,
   해당 위치로 이미지를 복사해서 정적 호스팅하는 걸 추천. */

/* 없는 이미지 대체용 SVG(플레이스홀더) */
const PLACEHOLDER_SVG =
  'data:image/svg+xml;utf8,' +
  encodeURIComponent(
    '<svg xmlns="http://www.w3.org/2000/svg" width="96" height="96" viewBox="0 0 96 96">' +
    '<rect width="96" height="96" rx="10" ry="10" fill="#f2f4f7" stroke="#e5e7eb"/>' +
    '<circle cx="48" cy="36" r="16" fill="#dde3ea"/>' +
    '<rect x="18" y="60" width="60" height="20" rx="10" fill="#dde3ea"/>' +
    '</svg>'
  );

/* 경로 생성 */
function portraitUrl(heroKey){ return PORTRAIT_BASE + heroKey + '/img_001.webp'; }

/* ================== 내장 데이터(SSR만) ================== */
/* 세그먼트 공식: base + Σ(길이 × delta). 3세대 L30=290.23, 4세대 L30=370.29 앵커 */
const SEG = {
  // Gen1
  Helga:{base:25.25,seg:[[1,5,2.35],[6,6,4.23],[7,11,3.29],[12,12,5.92],[13,17,4.6069],[18,18,8.29],[19,23,6.4494],[24,24,11.61],[25,29,9.0294],[30,30,16.25]]},
  Amadeus:{base:32.82,seg:[[1,5,3.0569],[6,6,5.49],[7,11,4.2775],[12,12,7.7],[13,17,5.9869],[18,18,10.78],[19,23,8.3825],[24,24,15.1],[25,29,11.7388],[30,30,21.12]]},
  Jabel:{base:25.25,seg:[[1,5,2.35],[6,6,4.23],[7,11,3.29],[12,12,5.92],[13,17,4.6069],[18,18,8.29],[19,23,6.4494],[24,24,11.61],[25,29,9.0294],[30,30,16.25]]},
  Saul:{base:25.25,seg:[[1,5,2.35],[6,6,4.23],[7,11,3.29],[12,12,5.92],[13,17,4.6069],[18,18,8.29],[19,23,6.4494],[24,24,11.61],[25,29,9.0294],[30,30,16.25]]},
  // Gen2
  Hilde:{base:30.30,seg:[[1,5,2.82],[6,6,5.07],[7,11,3.9475],[12,12,7.11],[13,17,5.5269],[18,18,9.95],[19,23,7.7394],[24,24,13.93],[25,26,10.83],[27,27,3.84],[28,28,17.83],[29,29,10.84],[30,30,19.41]]},
  Marlin:{base:30.30,seg:[[1,5,2.82],[6,6,5.07],[7,11,3.9475],[12,12,7.11],[13,17,5.5269],[18,18,9.95],[19,23,7.7394],[24,24,13.93],[25,26,10.83],[27,27,3.84],[28,28,17.83],[29,29,10.84],[30,30,19.41]]},
  Zoe:{base:30.30,seg:[[1,5,2.82],[6,6,5.07],[7,11,3.9475],[12,12,7.11],[13,17,5.5269],[18,18,9.95],[19,23,7.7394],[24,24,13.93],[25,26,10.83],[27,27,3.84],[28,28,17.83],[29,29,10.84],[30,30,19.41]]},
  // Gen3 (초기 말단 27~29 빈칸을 아래에서 채움)
  Eric:{base:36.61,seg:[[1,5,3.4094],[6,6,6.13],[7,11,4.77],[12,12,8.59],[13,17,6.6819],[18,18,12.02],[19,23,9.3544],[24,24,16.83],[25,26,13.085]]},
  Petra:{base:36.61,seg:[[1,5,3.4094],[6,6,6.13],[7,11,4.77],[12,12,8.59],[13,17,6.6819],[18,18,12.02],[19,23,9.3544],[24,24,16.83],[25,26,13.085]]},
  Jaeger:{base:36.61,seg:[[1,5,3.4094],[6,6,6.13],[7,11,4.77],[12,12,8.59],[13,17,6.6819],[18,18,12.02],[19,23,9.3544],[24,24,16.83],[25,26,13.085]]}
};
const GEN3_REF='Jaeger', GEN3_L30=290.23, GEN4_L30=370.29;

/* ===== 세그먼트/보정/앵커 유틸 ===== */
function statAtSegments(H,L){ let s=H.base; for(const [f,t,d] of H.seg){ if(L<f)break; const u=Math.min(L,t); s+=(u-f+1)*d; if(L<=t)break; } return s; }
function anchorLevel(name,level,target){
  const H=SEG[name]; if(!H) return;
  let i=H.seg.findIndex(([f,t])=>level>=f&&level<=t);
  if(i>=0){const [f,t,d]=H.seg[i]; if(!(f===level&&t===level)){const left=(level-1>=f)?[f,level-1,d]:null; const right=(level<=t)?[level,t,d]:null; H.seg.splice(i,1,...(left?[left]:[]),...(right?[right]:[]));}}
  const need=+(target - statAtSegments(H,level-1)).toFixed(4);
  const j=H.seg.findIndex(([f,t])=>f===level&&t===level);
  const fixed=[level,level,need]; if(j>=0)H.seg[j]=fixed; else H.seg.push(fixed);
}
function deltaAt(H,L){ const seg=H.seg.find(([f,t])=>L>=f&&L<=t); return seg?seg[2]:null; }

/* --- 3세대의 27/28/29 빈칸을 2세대 말단 패턴(스케일)로 보정 --- */
function fillLastCycleFromGen2(name){
  const H=SEG[name]; if(!H) return;
  const G2=SEG['Hilde']; if(!G2) return;
  const d25_26 = deltaAt(H,25), g2_25_26 = deltaAt(G2,25);
  const patt = [ deltaAt(G2,27), deltaAt(G2,28), deltaAt(G2,29) ]; // [3.84, 17.83, 10.84]
  if (d25_26==null || g2_25_26==null) return;
  const k = d25_26 / g2_25_26;
  [27,28,29].forEach((L,idx)=>{
    if (deltaAt(H,L)!=null) return;
    const d = +((patt[idx]||0)*k).toFixed(4);
    H.seg.push([L,L,d]);
  });
  H.seg.sort((a,b)=>a[0]-b[0]);
}

/* 3세대 말단 보정 → 앵커(290.23) → 4세대 생성(스케일) → 앵커(370.29) */
['Eric','Petra','Jaeger'].forEach(fillLastCycleFromGen2);
['Eric','Petra','Jaeger'].forEach(h=>anchorLevel(h,30,GEN3_L30));
(function buildGen4(){
  const ref=SEG[GEN3_REF]; if(!ref) return;
  const current=statAtSegments(ref,30), k=GEN4_L30/current;
  ['Alcar','Margot','Rosa'].forEach(n=>{
    SEG[n]={base:+(ref.base*k).toFixed(4), seg:ref.seg.map(([f,t,d])=>[f,t,+(d*k).toFixed(4)])};
    anchorLevel(n,30,GEN4_L30);
  });
})();

/* ===== 메타(정정 반영) ===== */
const META={
  Amadeus:{type:'infantry',gen:1,ko:'아마데우스'},
  Helga:{type:'infantry',gen:1,ko:'헬가'},
  Jabel:{type:'cavalry',gen:1,ko:'제이벨'},
  Saul:{type:'archer',gen:1,ko:'살로'},
  Zoe:{type:'infantry',gen:2,ko:'조이'},
  Hilde:{type:'cavalry',gen:2,ko:'힐데'},
  Marlin:{type:'archer',gen:2,ko:'마린'},
  Eric:{type:'infantry',gen:3,ko:'에릭'},
  Petra:{type:'cavalry',gen:3,ko:'리틀페라'},
  Jaeger:{type:'archer',gen:3,ko:'예거'},
  Alcar:{type:'infantry',gen:4,ko:'알카르'},
  Margot:{type:'cavalry',gen:4,ko:'마르고'},
  Rosa:{type:'archer',gen:4,ko:'로사'}
};

/* ============ 코어/라벨 ============ */
/* 표기 규칙:
   - 기본: 0★~4★ T1~T5
   - T6 도달 시: n성 (예: 0별 6티어 = 1성, ..., 4별 6티어 = 5성)
   - L=30(최종)은 자동으로 5성
*/
function levelToStarTier6(L){
  const star = Math.floor((L - 1) / 6);   // 0..4
  const tier = ((L - 1) % 6) + 1;         // 1..6
  if (tier === 6) return `${star + 1}성`;
  return `${star}★ T${tier}`;
}
function listHeroesByType(type){
  const all=Object.keys(META).filter(n=>META[n].type===type && SEG[n]);
  return all.sort((a,b)=>(META[a].gen - META[b].gen)||a.localeCompare(b));
}
function ko(n){return (META[n]&&META[n].ko)||n;}
function statAtHero(name,L){ const H=SEG[name]; if(!H) return 0; return statAtSegments(H,L); }

/* A가 B를 추월하려면 최소 몇 단계? (없으면 null) */
function minLevelToBeat(attacker,defender,defL){
  const target=statAtHero(defender,defL);
  for(let l=1;l<=30;l++) if(statAtHero(attacker,l)+0.005>=target) return {lv:l,target};
  return {lv:null,target};
}

/* ============ UI 바인딩 ============ */
document.querySelectorAll('.lane').forEach(section=>{
  const type=section.dataset.type;
  const [cardA,cardB]=section.querySelectorAll('.card');
  const selA=cardA.querySelector('.hero[data-side="A"]');
  const selB=cardB.querySelector('.hero[data-side="B"]');
  const lvlA=cardA.querySelector('.lvl[data-side="A"]');
  const lvlB=cardB.querySelector('.lvl[data-side="B"]');
  const lblA=cardA.querySelector('.lvlLabel[data-side="A"]');
  const lblB=cardB.querySelector('.lvlLabel[data-side="B"]');
  const statA=cardA.querySelector('.stat[data-side="A"]');
  const statB=cardB.querySelector('.stat[data-side="B"]');
  const cmpText=section.querySelector('.cmpText');
  const cmpHint=section.querySelector('.cmpHint');

  // 별 DOM
  const starsBoxA=cardA.querySelector('.stars[data-side="A"]');
  const starsBoxB=cardB.querySelector('.stars[data-side="B"]');
  const starsA=[...starsBoxA.querySelectorAll('.star')];
  const starsB=[...starsBoxB.querySelectorAll('.star')];

  // 초상화 DOM
  const portraitA=cardA.querySelector('.portrait[data-side="A"]');
  const portraitB=cardB.querySelector('.portrait[data-side="B"]');

  // 옵션 주입
  const list=listHeroesByType(type);
  selA.innerHTML=list.map(n=>`<option value="${n}">${ko(n)} (${n}) · ${META[n].gen}세대</option>`).join('');
  selB.innerHTML=selA.innerHTML;

  // 기본: A=3세대(있으면), B=4세대(있으면)
  selA.value=list.find(n=>META[n].gen===3) || list[0];
  selB.value=list.find(n=>META[n].gen===4) || list[1] || list[0];
  lvlA.value=1; lvlB.value=1;

  function tierOfLevel(L){ return ((L - 1) % 6) + 1; } // 1..6
  function starOfLevel(L){ return Math.floor((L - 1) / 6); } // 0..4

  // 5개 별에 0~6 단계 채우기 (L=30은 5개 모두 6)
  function setStarImages(starElems, L){
    if (L === 30){
      starElems.forEach(el => el.setAttribute('data-lv', 6));
      return;
    }
    const s = starOfLevel(L);   // 완료된 별 개수(0..4)
    const t = tierOfLevel(L);   // 현재 별 진행도(1..6)
    for(let i=0;i<5;i++){
      let lv = 0;
      if (i < s) lv = 6;
      else if (i === s) lv = t;
      else lv = 0;
      starElems[i].setAttribute('data-lv', lv);
    }
  }

  function setPortrait(imgEl, heroKey, sideLabel){
    if(!imgEl) return;
    imgEl.alt = `${sideLabel} 영웅 초상화 — ${ko(heroKey)} (${heroKey})`;
    imgEl.src = portraitUrl(heroKey);
    imgEl.onerror = () => { imgEl.onerror = null; imgEl.src = PLACEHOLDER_SVG; };
  }

  function render(){
    const A=selA.value, B=selB.value, LA=+lvlA.value, LB=+lvlB.value;

    // 라벨(요청 규칙: T6 → n성)
    lblA.textContent=levelToStarTier6(LA);
    lblB.textContent=levelToStarTier6(LB);

    // 별 아이콘 갱신
    setStarImages(starsA, LA);
    setStarImages(starsB, LB);

    // 접근성 라벨 갱신
    starsBoxA.setAttribute('aria-label', `A 성급: ${levelToStarTier6(LA)}`);
    starsBoxB.setAttribute('aria-label', `B 성급: ${levelToStarTier6(LB)}`);

    // 초상화 갱신
    setPortrait(portraitA, A, 'A');
    setPortrait(portraitB, B, 'B');

    // 수치 갱신
    const va=statAtHero(A,LA), vb=statAtHero(B,LB);
    statA.textContent=`+${va.toFixed(2)}%`;
    statB.textContent=`+${vb.toFixed(2)}%`;

    // 비교 문구
const aNeed = minLevelToBeat(A, B, LB);
const bNeed = minLevelToBeat(B, A, LA);
let line = '';

if (Math.abs(va - vb) < 0.005) {
  line = `현재 ${ko(A)}와 ${ko(B)}의 성능은 거의 차이가 없습니다.`;
} else if (va > vb) {
  line = `${ko(A)}가 우세한 상태입니다. (${levelToStarTier6(LA)} vs ${levelToStarTier6(LB)})`;
} else {
  line = `${ko(A)}가 ${ko(B)}를 따라잡으려면 최소 <b>${aNeed.lv ? levelToStarTier6(aNeed.lv) : '불가능 (최대 초과)'}</b>가 필요합니다.`;
}

const sub = `${ko(B)}가 ${ko(A)}를 앞서려면 ${bNeed.lv ? levelToStarTier6(bNeed.lv) : '불가능 (최대 초과)'}가 필요합니다.`;

cmpText.innerHTML = line;
cmpHint.textContent = sub;
  }

  [selA,selB,lvlA,lvlB].forEach(el=> el.addEventListener('input',render));
  render();
});
</script>
</body>
</html>
