<!doctype html>
<html lang="en">
<head>
  <meta name="google-adsense-account" content="ca-pub-9189957764761115">
  <meta charset="utf-8" />
  <script>window.__V="202601111500"</script>
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>KingshotData</title>
  <base href="/" />

  <!-- Adsense -->
  <script async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js?client=ca-pub-9189957764761115"
    crossorigin="anonymous"></script>

  <!-- Google Analytics 4 -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=G-TMGDGSEWW6"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());
    gtag('config', 'G-TMGDGSEWW6', { send_page_view: true });
  </script>

  <!-- Perf -->
  <link rel="preconnect" href="https://www.googletagmanager.com">
  <link rel="preconnect" href="https://pagead2.googlesyndication.com" crossorigin>
  <meta name="theme-color" content="#ffffff" />

  <!-- SEO / OG -->
  <meta name="description" content="" data-i18n-attr="content:meta.description">
  <meta property="og:title" content="KingshotData">
  <meta property="og:description" content="" data-i18n-attr="content:og.description">
  <meta property="og:image" content="https://kingshotdata.kr/img/kingshotdata-og-v5.png">
  <meta property="og:image:width" content="1200">
  <meta property="og:image:height" content="630">
  <meta property="og:url" content="https://kingshotdata.kr">
  <meta property="og:type" content="website">
  <link rel="canonical" href="https://kingshotdata.kr">
  <link rel="preload" as="image" href="/img/logo-kingshotdata.png?v=202509131858" />

  <!-- Site CSS -->
  <link rel="stylesheet" href="/css/common.css?v=202509131858">
  <link rel="stylesheet" href="/css/category.css?v=202509131858">
  <link rel="stylesheet" href="/css/database.css?v=202509131858">
  <link rel="stylesheet" href="/css/mobile-patch.css?v=202509131858">
  <link rel="stylesheet" href="/css/footer-tools.css?v=202509131858">
  <link rel="stylesheet" href="/css/header.css?v=202509131858">
  <link rel="stylesheet" href="/css/sponsor.css?v=202509131858">

  <!-- ★ GitHub Pages용 SPA Fallback 복원 스크립트 -->
  <script>
    (function () {
      var params = new URLSearchParams(location.search);
      var p = params.get('p');
      if (p) {
        var rest = [];
        params.forEach(function (v, k) { if (k !== 'p') rest.push(k + '=' + encodeURIComponent(v)); });
        var newUrl = p + (rest.length ? (p.indexOf('?') >= 0 ? '&' : '?') + rest.join('&') : '');
        history.replaceState(null, '', newUrl);
      }
    })();
  </script>

  <!-- i18n 먼저 -->
  <script src="/js/i18n.js?v=202509131858"></script>
  <script>
    // ✅ zh-CN 완전 제거 + 안전 정규화 (TW 유지)
    function normalizeLang(code){
      var low = String(code || '').trim().toLowerCase();

      if (low === 'ko') return 'ko';
      if (low === 'en') return 'en';
      if (low === 'ja') return 'ja';

      // TW 계열은 zh-TW로 통일
      if (low === 'tw' || low === 'zh-tw' || low === 'zh_tw') return 'zh-TW';

      // CN은 en으로 폴백
      if (low === 'cn' || low === 'zh-cn' || low === 'zh_cn') return 'en';

      return 'en';
    }

    (function () {
      const sp = new URLSearchParams(location.search);
      const urlLangRaw = sp.get('lang');
      let savedRaw = null; try { savedRaw = localStorage.getItem('lang'); } catch(_){}

      const initial = normalizeLang(urlLangRaw || savedRaw || 'en');
      document.documentElement.setAttribute('lang', initial);

      // i18n init
      if (window.I18N?.init) {
        I18N.init({ lang: initial, supported: ['ko','en','ja','zh-TW'] });
      }

      // URL/저장값이 비정상 코드였으면 즉시 정리(리로드 없음)
      try {
        if (urlLangRaw && normalizeLang(urlLangRaw) !== urlLangRaw) {
          const url = new URL(window.location.href);
          url.searchParams.set('lang', initial);
          history.replaceState(null, '', url.toString());
        }
      } catch(_) {}
      try {
        if (savedRaw && normalizeLang(savedRaw) !== savedRaw) {
          localStorage.setItem('lang', initial);
        }
      } catch(_) {}
    })();

    // ✅ SPA 언어 변경 (새로고침 없음)
    async function applyLang(lang){
      lang = normalizeLang(lang);

      if (window.I18N?.setLang) await I18N.setLang(lang);

      document.documentElement.setAttribute('lang', lang);
      try { localStorage.setItem('lang', lang); } catch(_){}

      // ✅ URL에 lang만 유지 (리로드 X)
      try {
        const url = new URL(window.location.href);
        url.searchParams.set('lang', lang);
        history.replaceState(null, '', url.toString());
      } catch(_) {}
    }
  </script>

  <!-- 앱 -->
  <script defer src="/js/routes.js?v=202509131858"></script>
  <script defer src="/js/app.js?v=202509131858"></script>
  <script defer src="/js/footer-tools.js?v=202509131858"></script>

  <style>
    /* (선택) 혹시 모를 가로 스크롤 방지 */
    html, body { overflow-x: hidden; }

    /* ✅ Kitchen 톤(미니멀) 헤더용 브랜드 텍스트 */
    .brand.brand-pro{
      display:flex;
      align-items:center;
      gap:10px;
      color:#111827;
      text-decoration:none;
      font-weight:900;
      letter-spacing:.1px;
      min-width:0;
    }
    .brand.brand-pro .brand-logo{
      width:28px;
      height:28px;
      border-radius:8px;
      display:block;
      flex:0 0 auto;
    }
    .brand.brand-pro .brand-text{
      display:flex;
      flex-direction:column;
      line-height:1.1;
      min-width:0;
    }
    .brand.brand-pro .brand-title{
      font-size:16px;
      font-weight:900;
      white-space:nowrap;
      overflow:hidden;
      text-overflow:ellipsis;
    }
    .brand.brand-pro .brand-sub{
      font-size:12px;
      color:#6b7280;
      white-space:nowrap;
      overflow:hidden;
      text-overflow:ellipsis;
    }
    /* 모바일 70% 대응: 초소형에서 서브라인 숨김 */
    @media (max-width: 520px){
      .brand.brand-pro .brand-title{ font-size:14px; }
      .brand.brand-pro .brand-sub{ display:none; }
    }

    /* ✅ Language pills (EN KO JA TW) */
    .lang-pills{
      display:flex;
      align-items:center;
      gap:8px;
      flex-wrap:wrap;
    }
    .lang-pill{
      appearance:none;
      border:1px solid #e5e7eb;
      background:#fff;
      color:#6b7280;
      padding:8px 10px;
      border-radius:999px;
      font:13px/1.1 system-ui,-apple-system,Segoe UI,Roboto,"Noto Sans",Arial;
      cursor:pointer;
      white-space:nowrap;
    }
    .lang-pill:hover{ color:#111827; }
    .lang-pill[aria-current="true"]{
      color:#111827;
      font-weight:800;
    }

    /* 드로어에서는 2열 그리드로 (모바일 안정) */
    .lang-pills--drawer{
      display:grid;
      grid-template-columns:repeat(2, minmax(0,1fr));
      gap:8px;
      margin-top:2px;
    }
    .lang-pills--drawer .lang-pill{
      width:100%;
      justify-content:center;
    }
  </style>
</head>

<body class="theme-default">
  <!-- ===== Header ===== -->
  <header class="site-header" role="banner">
    <div class="container nav-bar">
      <div class="nav-left">
        <!-- ✅ Kitchen 헤더 타이틀 톤 채택 + 로고는 KingshotData 로고로 교체 + 텍스트 2줄 -->
        <a class="brand brand-pro" href="/home"
           aria-label="KingshotData Home"
           data-i18n-attr="aria-label:aria.home">
          <img class="brand-logo" src="/img/kingshotdata-logo.png?v=20260301"
               alt="Kingshot Data" width="28" height="28" decoding="async" fetchpriority="high">
          <span class="brand-text">
            <span class="brand-title">Kingshot Data</span>
            <span class="brand-sub">Game Database &amp; Strategy Hub</span>
          </span>
        </a>

        <!-- ✅ 네비는 그대로 유지 -->
        <nav class="nav" id="primaryNav" role="navigation"
             aria-label="Primary"
             data-i18n-attr="aria-label:aria.primaryNav">
          <a href="/buildings"  data-link data-i18n="nav.buildings">건물</a>
          <a href="/heroes"     data-link data-i18n="nav.heroes">영웅</a>
          <a href="/database"   data-link data-i18n="nav.database">데이터베이스</a>
          <a href="/guides"     data-link data-i18n="nav.guides">가이드</a>
          <a href="/calculator" data-link data-i18n="nav.calculators">계산기</a>
          <a href="/about"      data-link data-i18n="nav.about">소개</a>
        </nav>
      </div>

      <button class="hamburger" id="menuToggle"
              aria-label="Open menu"
              aria-controls="mobileDrawer" aria-expanded="false"
              data-i18n-attr="aria-label:aria.menuOpen">☰</button>

      <div class="nav-right">
        <!-- ✅ Language pills (노출형) -->
        <div id="langDropdownHeader" class="lang-pills" aria-label="Language"></div>
      </div>
    </div>
  </header>

  <!-- ✅ Sponsor strip 제거됨 (나중에 다른 광고로 교체 예정) -->

  <!-- ===== Drawer ===== -->
  <div class="backdrop" id="backdrop" hidden></div>

  <aside class="drawer" id="mobileDrawer" aria-hidden="true"
         aria-label="Mobile navigation"
         data-i18n-attr="aria-label:aria.mobileNav">
    <header>
      <strong data-i18n="drawer.menu">Menu</strong>
      <button id="btnClose" aria-label="Close"
              data-i18n-attr="aria-label:aria.close"
              style="background:none;border:0;font-size:20px;cursor:pointer">✕</button>
    </header>

    <div class="section" style="position:relative">
      <!-- ✅ Language pills (노출형) -->
      <div id="langDropdownDrawer" class="lang-pills lang-pills--drawer" aria-label="Language"></div>
    </div>

    <div class="rule"></div>

    <div class="section">
      <div class="sec-label" data-i18n="drawer.navigation">navigation</div>
      <div class="nav-list" role="navigation"
           aria-label="Drawer navigation"
           data-i18n-attr="aria-label:aria.drawerNav">
        <a href="/buildings"  data-link data-i18n="nav.buildings">건물</a>
        <a href="/heroes"     data-link data-i18n="nav.heroes">영웅</a>
        <a href="/database"   data-link data-i18n="nav.database">데이터베이스</a>
        <a href="/guides"     data-link data-i18n="nav.guides">가이드</a>
        <a href="/calculator" data-link data-i18n="nav.calculators">계산기</a>
      </div>
    </div>

    <div class="rule"></div>

    <div class="section">
      <div class="sec-label" data-i18n="drawer.other">other</div>

      <div class="tile-grid">
        <a class="tile" href="https://kingshotdata.kr/pages/guides/kingshot-giftcode.html" target="_blank" rel="noopener">
          <svg class="icon-24" viewBox="0 0 24 24" aria-hidden="true">
            <rect x="3" y="8" width="18" height="13" rx="2" fill="none" stroke="#111" stroke-width="1.6"/>
            <path d="M12 21V8M3 12h18M7 5c-1 0-2 .7-2 1.8S6 9 7.5 9C9 9 10 7 10 6s-1-1-3-1Zm10 0c1 0 2 .7 2 1.8S18 9 16.5 9C15 9 14 7 14 6s1-1 3-1Z"
              fill="none" stroke="#111" stroke-width="1.6" stroke-linecap="round"/>
          </svg>
          <div class="meta"><span class="tit">Gift Code</span></div>
        </a>

        <a class="tile tile-kakao" href="https://open.kakao.com/o/gHPnO4uh" target="_blank" rel="noopener">
          <svg class="icon-24" viewBox="0 0 24 24" aria-hidden="true">
            <path d="M12 3c5.2 0 9 3 9 6.8 0 3.9-4.1 7.1-9.2 7.1-.6 0-1.2 0-1.8-.1L6 20l1.5-3.1C6 16 3 14 3 9.8 3 6 6.8 3 12 3Z" fill="#111"/>
          </svg>
          <div class="meta"><span class="tit">KakaoTalk</span></div>
        </a>
      </div>
    </div>
  </aside>

  <!-- ===== Main ===== -->
  <main class="container" id="main" role="main"
        aria-label="Main content"
        data-i18n-attr="aria-label:aria.main">
    <div id="content" class="panel">
      <noscript data-nosnippet data-i18n="misc.enableJs">
        자바스크립트를 활성화하세요. 콘텐츠가 표시됩니다.
      </noscript>
    </div>
  </main>

  <!-- ===== Footer ===== -->
  <footer class="site-footer" role="contentinfo"
          aria-label="Footer"
          data-i18n-attr="aria-label:aria.footer">
    <div class="container">
      <!-- Footer Tools (쿠폰 → 버튼 → 배너는 JS에서 렌더링) -->
      <div id="footerTools" class="footer-tools"></div>

      <span data-i18n="footer.copyrightLine1">
        All game images and data are copyrighted by Century Games.
      </span><br />

      <span data-i18n="footer.fansiteNotice">
        This site is an unofficial fan site.
      </span><br />

      <span>© 2025 KingshotData Korea · </span>
      <a href="/privacy/" data-i18n="footer.privacy">개인정보처리방침 / Privacy</a>
    </div>
  </footer>

  <!-- 🔧 Footer LootBar 배너 언어별 이미지 스위치 (footer-tools.js가 만든 이미지 대상으로 처리) -->
  <script>
    (function(){
      function updateLootbarBanner(){
        const img = document.querySelector('.footer-image-banner img');
        if (!img) return;

        const lang =
          window.I18N?.current ||
          document.documentElement.getAttribute('lang') ||
          'en';

        img.src = (lang === 'ko') ? '/img/lootbarkr.png' : '/img/lootbar.png';
      }

      document.addEventListener('DOMContentLoaded', updateLootbarBanner);

      if (window.I18N && typeof I18N.setLang === 'function') {
        const _setLang = I18N.setLang.bind(I18N);
        I18N.setLang = async function(lang){
          await _setLang(normalizeLang(lang));
          document.documentElement.setAttribute('lang', normalizeLang(lang));
          updateLootbarBanner();
        };
      }
    })();
  </script>

  <!-- 🔧 Drawer toggle -->
  <script>
    document.addEventListener('DOMContentLoaded', () => {
      const html = document.documentElement, body = document.body;
      const drawer = document.getElementById('mobileDrawer');
      const backdrop = document.getElementById('backdrop');
      const btnOpen = document.getElementById('menuToggle');
      const btnClose = document.getElementById('btnClose');

      function openDrawer(){
        html.classList.add('is-open');
        body.classList.add('no-scroll');
        backdrop.hidden = false;
        drawer.setAttribute('aria-hidden','false');
        btnOpen?.setAttribute('aria-expanded','true');
        btnClose?.focus();
      }

      function closeDrawer(){
        html.classList.remove('is-open');
        body.classList.remove('no-scroll');
        backdrop.hidden = true;
        drawer.setAttribute('aria-hidden','true');
        btnOpen?.setAttribute('aria-expanded','false');
        btnOpen?.focus();
      }

      btnOpen?.addEventListener('click', openDrawer);
      btnClose?.addEventListener('click', closeDrawer);
      backdrop?.addEventListener('click', closeDrawer);
      window.addEventListener('keydown', e => { if(e.key === 'Escape') closeDrawer(); });
      drawer.querySelectorAll('a[data-link]')?.forEach(a => a.addEventListener('click', closeDrawer));
    });
  </script>

  <!-- ✅ Language pills script (EN KO JA TW) -->
  <script>
    (function(){
      const LANGS = [
        {code:'en',    label:'EN'},
        {code:'ko',    label:'KO'},
        {code:'ja',    label:'JA'},
        {code:'zh-TW', label:'TW'},
      ];

      function getCurrentLang(){
        return normalizeLang(window.I18N?.current || document.documentElement.getAttribute('lang') || 'en');
      }

      function render(root){
        if (!root) return;
        const cur = getCurrentLang();
        root.innerHTML = LANGS.map(l => (
          '<button type="button" class="lang-pill" data-lang="' + l.code + '" aria-current="' + (l.code===cur ? 'true':'false') + '">' +
            l.label +
          '</button>'
        )).join('');
      }

      async function onClick(e){
        const btn = e.target.closest && e.target.closest('.lang-pill[data-lang]');
        if (!btn) return;
        e.preventDefault();
        await applyLang(btn.getAttribute('data-lang'));
        syncAll();
      }

      function syncAll(){
        render(document.getElementById('langDropdownHeader'));
        render(document.getElementById('langDropdownDrawer'));
      }

      document.addEventListener('DOMContentLoaded', () => {
        syncAll();

        const h = document.getElementById('langDropdownHeader');
        const d = document.getElementById('langDropdownDrawer');
        h && h.addEventListener('click', onClick);
        d && d.addEventListener('click', onClick);

        // i18n 이벤트가 있는 경우도 동기화
        document.addEventListener('i18n:changed', syncAll);
      });
    })();
  </script>
</body>
</html>